<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebAR PNG Animation</title>
    <style>
      .arjs-loader {
        position: absolute; top:0; left:0;
        width:100%; height:100%;
        background: rgba(0,0,0,0.8);
        display:flex; justify-content:center; align-items:center;
        color:white; font-size:1.2em;
        z-index:9999;
      }
    </style>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  </head>
  <body style="margin:0; overflow:hidden;">
    <div class="arjs-loader"><div>Loading AR assets, please wait...</div></div>

    <a-scene embedded vr-mode-ui="enabled:false"
             renderer="logarithmicDepthBuffer:true;"
             arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <!-- PNG 프레임들 -->
        <img id="frame_000" src="frames/frame_000.png">
        <!-- ... -->
        <img id="frame_022" src="frames/frame_022.png">
      </a-assets>

      <a-nft type="nft" url="AR"
             smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5"
             @markerFound="onStart()" @markerLost="onStop()">

        <a-plane id="animPlane" visible="false"
                 position="0 0 0" rotation="-90 0 0"
                 width="2" height="2"
                 material="src: #frame_000; transparent: true;">
        </a-plane>

      </a-nft>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const plane = document.querySelector('#animPlane');
      const marker = document.querySelector('a-nft');
      const totalFrames = 23;
      let interval = null, current = 0;

      function onStart() {
        plane.setAttribute('visible', true);
        if (!interval) interval = setInterval(() => {
          const id = '#frame_' + String(current).padStart(3,'0');
          plane.setAttribute('material', 'src', id);
          current = (current + 1) % totalFrames;
        }, 100);
      }

      function onStop() {
        plane.setAttribute('visible', false);
        clearInterval(interval);
        interval = null;
        current = 0;
      }

      marker.addEventListener('markerFound', onStart);
      marker.addEventListener('markerLost', onStop);

      // 로딩 완료 시 로더 숨기기
      window.addEventListener('load', () => {
        document.querySelector('.arjs-loader').style.display = 'none';
      });
    </script>
  </body>
</html>
